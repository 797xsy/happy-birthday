<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday Heart Animation</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: radial-gradient(circle at center, #120014 0%, #000 100%);
    height: 100%;
  }
  canvas { display: block; }
</style>
</head>
<body>

<script>
let heartParticles = [];
let textParticles = [];
let font;
let explosion = 0;
let exploding = true;
let glowShift = 0;

function preload() {
  font = loadFont('https://fonts.gstatic.com/s/lobster/v30/neILzCirqoswsqX9_oWsMqEzSJQ.ttf');
}

function setup() {
  createCanvas(windowWidth, windowHeight);
  pixelDensity(1);
  noStroke();
  textFont(font);
  initHeart();
  initText();
}

function initHeart() {
  heartParticles = [];
  for (let i = 0; i < 1500; i++) {
    heartParticles.push(new HeartParticle());
  }
}

function initText() {
  textParticles = [];
  let txt = "Happy Birthday";
  let fontSize = min(width, height) / 7;
  let bounds = font.textBounds(txt, 0, 0, fontSize);
  let x = width / 2 - bounds.w / 2;
  let y = height * 0.85;
  let points = font.textToPoints(txt, x, y, fontSize, { sampleFactor: 0.2 });

  for (let p of points) {
    textParticles.push(new TextParticle(p.x, p.y));
  }
}

function draw() {
  background(0, 0, 0, 40);
  explosion += (exploding ? 0.04 : -0.04);
  if (explosion > 1.5) exploding = false;
  if (explosion < 0.5) exploding = true;

  glowShift += 0.05;

  for (let p of heartParticles) {
    p.update(explosion);
    p.show();
  }
  for (let p of textParticles) {
    p.update();
    p.show(glowShift);
  }
}

function heartFunction(t) {
  let x = 16 * pow(sin(t), 3);
  let y = 13 * cos(t) - 5 * cos(2*t) - 2 * cos(3*t) - cos(4*t);
  return createVector(x, -y);
}

class HeartParticle {
  constructor() {
    this.t = random(TWO_PI);
    this.base = heartFunction(this.t);
    this.offset = random(0.3, 1);
    this.pos = this.base.copy().mult(this.offset);
    this.size = random(1.5, 3);
    this.alpha = random(180, 255);
  }
  update(scaleFactor) {
    let baseScale = min(width, height) / 45;
    let factor = baseScale * scaleFactor * this.offset;
    let target = heartFunction(this.t).mult(factor);
    this.pos.lerp(target, 0.1);
  }
  show() {
    let glow = color(255, 120 + random(-10, 20), 220 + random(-10, 20), this.alpha);
    fill(glow);
    ellipse(width/2 + this.pos.x, height/2 + this.pos.y - 120, this.size);
  }
}

class TextParticle {
  constructor(x, y) {
    this.origin = createVector(x, y);
    this.pos = this.origin.copy().add(p5.Vector.random2D().mult(random(20)));
    this.vel = p5.Vector.random2D().mult(random(0.2));
    this.size = random(2, 3);
    this.alpha = random(180, 255);
  }
  update() {
    this.pos.lerp(this.origin, 0.07);
    this.vel.add(p5.Vector.random2D().mult(0.03));
    this.pos.add(this.vel);
    this.vel.mult(0.9);
  }
  show(shift) {
    let glowPhase = (sin(shift + this.origin.x * 0.02) + 1) / 2;
    let r = lerp(200, 255, glowPhase);
    let g = lerp(100, 180, glowPhase);
    let b = lerp(220, 255, glowPhase);
    fill(r, g, b, this.alpha);
    ellipse(this.pos.x, this.pos.y, this.size);
  }
}

function windowResized() {
  resizeCanvas(windowWidth, windowHeight);
  initHeart();
  initText();
}
</script>

</body>
</html>
